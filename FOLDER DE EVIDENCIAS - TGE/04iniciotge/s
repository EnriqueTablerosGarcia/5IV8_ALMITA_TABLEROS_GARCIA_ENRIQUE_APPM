// Importaci칩n de dependencias necesarias
import React, { useState } from 'react'; // Importa React y el hook useState para manejar estados internos del componente
import { 
  SafeAreaView, // Evita que el contenido se superponga con las zonas seguras del dispositivo
  View, // Contenedor gen칠rico para agrupar elementos
  Text, // Permite mostrar texto en pantalla
  TextInput, // Campo de texto editable (para ingresar usuario y contrase침a)
  TouchableOpacity, // Bot칩n t치ctil que responde al presionarlo
  Image, // Muestra im치genes (como la foto de perfil)
  StyleSheet, // Define los estilos visuales de los componentes
  Alert // Muestra mensajes emergentes tipo alerta
} from 'react-native';

// Importa la librer칤a Expo ImagePicker para seleccionar im치genes desde la galer칤a del dispositivo
import * as ImagePicker from 'expo-image-picker';

// Componente principal de la aplicaci칩n
export default function App() {

  // ==============================
  // 游댳 DECLARACI칍N DE ESTADOS
  // ==============================
  const [user, setUser] = useState(''); // Guarda el nombre del usuario que se escribe en el input
  const [pass, setPass] = useState(''); // Guarda la contrase침a ingresada
  const [imageUri, setImageUri] = useState(null); // Guarda la direcci칩n (URI) de la imagen seleccionada
  const [loggedIn, setLoggedIn] = useState(false); // Controla si el usuario ha iniciado sesi칩n o no

  // ==============================
  // 游댳 FUNCI칍N: validarLogin()
  // ==============================
  // Esta funci칩n verifica si el usuario y la contrase침a coinciden con los valores correctos.
  const validarLogin = () => {
    const validUser = 'admin'; // Usuario correcto
    const validPass = '1234';  // Contrase침a correcta

    // Verifica si los datos ingresados son correctos
    if (user === validUser && pass === validPass) {
      Alert.alert('Correcto', 'Inicio de sesi칩n exitoso'); // Muestra mensaje de 칠xito
      setLoggedIn(true); // Cambia el estado a "logueado" para mostrar la pantalla de perfil
    } else {
      Alert.alert('Error', 'Usuario o contrase침a incorrectos'); // Muestra mensaje de error
    }
  };

  // ==============================
  // 游댳 FUNCI칍N: cambiarImagen()
  // ==============================
  // Esta funci칩n permite cambiar la foto de perfil al seleccionar una imagen desde la galer칤a.
  const cambiarImagen = async () => {
    // Solicita permiso para acceder a la galer칤a del dispositivo
    const { status } = await ImagePicker.requestMediaLibraryPermissionsAsync();

    // Si el usuario no da permiso, se muestra una alerta y se detiene el proceso
    if (status !== 'granted') {
      Alert.alert('Permiso denegado', 'Se necesita acceso a las im치genes');
      return;
    }

    // Abre la galer칤a del dispositivo para que el usuario elija una imagen
    const result = await ImagePicker.launchImageLibraryAsync({
      mediaTypes: ImagePicker.MediaTypeOptions.Images, // Solo permite im치genes (no videos)
      allowsEditing: true, // Permite recortar o editar la imagen
      quality: 0.8, // Define la calidad de la imagen (0.8 = 80%)
    });

    // Si el usuario no cancel칩 y seleccion칩 una imagen, se guarda su URI
    if (!result.canceled) {
      setImageUri(result.assets[0].uri);
    }
  };

  // ==============================
  // 游댳 RETORNO VISUAL (RENDER)
  // ==============================
  // Aqu칤 se define lo que se mostrar치 en pantalla dependiendo del estado "loggedIn"
  return (
    <SafeAreaView style={styles.container}>
      
      {/* Si el usuario NO ha iniciado sesi칩n, se muestra el formulario de login */}
      {!loggedIn ? (
        <View style={styles.box}>
          <Text style={styles.title}>Iniciar Sesi칩n</Text>

          {/* Campo para escribir el nombre de usuario */}
          <TextInput
            placeholder="Usuario"
            style={styles.input}
            value={user} // Vinculado al estado "user"
            onChangeText={setUser} // Actualiza el estado cada vez que se escribe
          />

          {/* Campo para escribir la contrase침a */}
          <TextInput
            placeholder="Contrase침a"
            style={styles.input}
            value={pass} // Vinculado al estado "pass"
            onChangeText={setPass} // Actualiza el estado con lo que se escribe
            secureTextEntry // Oculta el texto para que no se vea la contrase침a
          />

          {/* Bot칩n para validar el inicio de sesi칩n */}
          <TouchableOpacity style={styles.button} onPress={validarLogin}>
            <Text style={styles.btnText}>Entrar</Text>
          </TouchableOpacity>
        </View>
      ) : (
        // Si el usuario ya inici칩 sesi칩n, se muestra la pantalla de bienvenida con la foto
        <View style={styles.box}>
          <Text style={styles.title}>Bienvenido carnal pulpo {user}</Text>

          {/* Imagen de perfil: al presionarla, permite cambiarla */}
          <TouchableOpacity onPress={cambiarImagen}>
            <Image
              source={{
                uri: imageUri || // Si ya hay una imagen seleccionada, se muestra
                  // Si no, se usa una imagen predeterminada
                  'https://static.vecteezy.com/system/resources/previews/005/005/840/non_2x/user-icon-in-trendy-flat-style-isolated-on-grey-background-user-symbol-for-your-web-site-design-logo-app-ui-illustration-eps10-free-vector.jpg'
              }}
              style={styles.image} // Aplica los estilos definidos
            />
          </TouchableOpacity>
        </View>
      )}
    </SafeAreaView>
  );
}

// ==============================
// 游댳 SECCI칍N DE ESTILOS
// ==============================
// Aqu칤 se definen los estilos visuales de cada componente.
const styles = StyleSheet.create({
  container: {
    flex: 1, // Ocupa toda la pantalla
    justifyContent: 'center', // Centra los elementos verticalmente
    alignItems: 'center', // Centra los elementos horizontalmente
    backgroundColor: '#522e2eff', // Color de fondo general
  },
  box: {
    width: '80%', // Ancho del contenedor
    backgroundColor: 'white', // Fondo blanco del cuadro
    padding: 20, // Espaciado interno
    borderRadius: 10, // Bordes redondeados
    alignItems: 'center', // Centra los elementos dentro
    elevation: 3, // Agrega sombra en Android
  },
  title: {
    fontSize: 20, // Tama침o de letra
    marginBottom: 20, // Espacio debajo del t칤tulo
  },
  input: {
    width: '100%',
    borderWidth: 1, // Borde visible
    borderColor: '#ccc', // Color del borde gris claro
    borderRadius: 5, // Bordes redondeados
    padding: 10, // Espacio interno
    marginBottom: 10, // Espacio entre campos
  },
  button: {
    backgroundColor: '#007bff', // Color azul del bot칩n
    paddingVertical: 10, // Altura del bot칩n
    borderRadius: 5, // Bordes redondeados
    width: '100%', // Ancho total
    alignItems: 'center', // Centra el texto dentro del bot칩n
  },
  btnText: {
    color: '#fff', // Texto blanco
  },
  image: {
    width: 120, // Ancho de la imagen
    height: 120, // Alto de la imagen
    borderRadius: 60, // Forma circular
    marginTop: 10, // Espacio superior
  },
  imagePlaceholder: {
    width: 120,
    height: 120,
    borderRadius: 60,
    backgroundColor: '#e0e0e0', // Fondo gris si no hay imagen
    justifyContent: 'center',
    alignItems: 'center',
    marginTop: 10,
  },
});
